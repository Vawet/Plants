import{a as T}from"./axios-NIGUFBhG.js";import{k as r,o as j,p as D,q as L,j as R,r as $,s as A,t as M,u as G,v as H}from"./element-plus-CDN9BKpg.js";import"./editService-BWOmej4D.js";import{p as J,n as V,o as O,q as K,v as Q,r as W,u as X}from"./@element-plus-Bc65TjFU.js";import{_ as Y}from"./index-BPo7qd-I.js";import{r as h,p as w,c as g,a as t,Q as l,O as s,o as m,a3 as d,u,K as x,ag as k,M as Z,S as v,J as ee,T as ae}from"./@vue-CisjAB5t.js";import"./@vueuse-Cg8ssQxY.js";import"./@unhead-kqohiLkD.js";import"./unhead-C_h-0uJb.js";import"./hookable-B8xFkYCm.js";import"./lodash-es-DCo95CJQ.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-CRx4dHSJ.js";import"./@popperjs-DB1lLFnh.js";import"./vue-router-Cy3-6-Xz.js";import"./pinia-BRCzBT2l.js";const te="http://localhost:3000/api/plants",le=async i=>{try{const e=new FormData;console.log(i.images),i.images.forEach(f=>{if(["image/jpeg","image/jpg","image/png"].includes(f.rawFile.type))e.append("plants",f.rawFile);else{r.error("图片格式不符合要求！");return}}),e.append("sid",i.category),e.append("desch",i.descriptionCn),e.append("desen",i.descriptionEn),e.append("name",i.name),e.append("ename",i.ename);const _=await T.post(`${te}/updatePlants`,e,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`},withCredentials:!0});_.data.code===200&&r.success(`成功上传${_.data.count}张植物图片`)}catch(e){r.error(`上传失败: ${e.response?.data?.message||e.message}`)}},se={class:"admin-container"},oe={class:"admin-main"},ne={class:"form-container"},re={class:"form-grid"},ie={class:"form-section"},de={class:"form-section-title"},ue={class:"form-section-title",style:{"margin-top":"30px"}},pe={class:"el-upload__tip"},ce={class:"form-section"},me={class:"form-section-title"},ge={class:"name-container"},ve={class:"lang-container"},_e={class:"lang-box"},fe={class:"lang-box"},ye={class:"preview-section"},be={class:"preview-title"},he={class:"preview-grid"},we={class:"plant-category"},Ee={class:"plant-details"},Ce={class:"plant-name"},Ve={class:"plant-description"},xe={class:"plant-intro"},ke={key:0,class:"plant-card"},Fe={class:"plant-image",style:{background:"#f0f9eb",display:"flex","align-items":"center","justify-content":"center"}},Ie={class:"form-actions"},Be={__name:"Home",setup(i){const e=h({images:[],category:"",descriptionCn:"",descriptionEn:"",name:"",ename:""}),_=h({images:[{required:!0,message:"请至少上传一张图片",trigger:"change"}],category:[{required:!0,message:"请选择植物系别",trigger:"change"}],descriptionCn:[{required:!0,message:"请输入中文介绍",trigger:"blur"},{min:10,message:"介绍至少需要10个字符",trigger:"blur"}],name:[{required:!0,message:"请输入植物中文学名",trigger:"blur"},{min:2,message:"名称至少需要2个字符",trigger:"blur"}],ename:[{required:!0,message:"请输入植物英文学名",trigger:"blur"},{min:2,message:"名称至少需要2个字符",trigger:"blur"}]}),f=h([{value:"1",label:"1: 草本植物"},{value:"2",label:"2: 木本植物"},{value:"3",label:"3: 多肉植物"},{value:"4",label:"4: 水生植物"},{value:"5",label:"5: 藤本植物"},{value:"6",label:"6: 食虫植物"},{value:"7",label:"7: 蕨类植物"},{value:"8",label:"8: 兰科植物"},{value:"9",label:"9: 苔藓植物"},{value:"10",label:"10: 珍稀植物"}]),F=w(()=>e.value.images.length);w(()=>e.value.authorBio.length),w(()=>e.value.authorBioEn.length);const I=(p,a)=>{if(a.length>10){r.warning("每个植物系最多只能添加10张图片");return}const n=p.raw;if(n){const y=new FileReader;y.onload=c=>{e.value.images.push({name:n.name,url:c.target.result,rawFile:n})},y.readAsDataURL(n)}},B=(p,a)=>{e.value.images=a},U=()=>{if(e.value.descriptionCn){const p=e.value.descriptionCn.replace(/植物/g,"plant").replace(/花/g,"flower").replace(/叶/g,"leaf").replace(/绿色/g,"green").replace(/美丽/g,"beautiful").replace(/特性/g,"characteristics").replace(/生长/g,"grow");e.value.descriptionEn=p+" [auto-translated]"}else e.value.descriptionEn=""},E=()=>{e.value={images:[],category:"",descriptionCn:"",descriptionEn:"",name:"",ename:""},r.success("表单已重置")},q=async()=>{if(console.log(e.value.images),!e.value.images.length){r.warning("请至少上传一张图片");return}if(!e.value.category){r.warning("请选择植物系别");return}if(!e.value.descriptionCn){r.warning("请填写植物中文介绍");return}const p=H.service({lock:!0,text:"正在提交数据...",background:"rgba(0, 0, 0, 0.7)"});try{await le(e.value)}catch(a){r.error("提交数据时出错，请稍后再试"),console.error(a)}finally{p.close(),E()}};return(p,a)=>{const n=D,y=R,c=L,z=A,N=$,b=M,C=G,P=j;return m(),g("div",se,[a[17]||(a[17]=t("div",{class:"admin-header"},[t("div",null,[t("h1",{class:"admin-title"},"前台主页编辑"),t("div",{class:"admin-subtitle"})])],-1)),t("div",oe,[t("div",ne,[l(P,{ref:"plantForm",model:e.value,rules:_.value,"label-position":"top"},{default:s(()=>[t("div",re,[t("div",ie,[t("h3",de,[l(n,null,{default:s(()=>[l(u(J))]),_:1}),a[5]||(a[5]=d(" 植物图片上传 "))]),l(c,{prop:"images"},{default:s(()=>[l(y,{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":I,"on-remove":B,"file-list":e.value.images,multiple:""},{default:s(()=>[l(n,null,{default:s(()=>[l(u(V))]),_:1})]),_:1},8,["file-list"]),a[6]||(a[6]=t("div",{class:"el-upload__tip"}," 可一次选择多张图片上传，支持 JPG/PNG 格式，每张图片不超过 5MB ",-1))]),_:1,__:[6]}),t("h3",ue,[l(n,null,{default:s(()=>[l(u(O))]),_:1}),a[7]||(a[7]=d(" 植物系别选择 "))]),l(c,{prop:"category"},{default:s(()=>[l(N,{modelValue:e.value.category,"onUpdate:modelValue":a[0]||(a[0]=o=>e.value.category=o),placeholder:"请选择植物系别 (1-10)",style:{width:"100%"}},{default:s(()=>[(m(!0),g(x,null,k(f.value,o=>(m(),Z(z,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t("div",pe," 每个植物系最多可添加10张图片，当前系别已上传: "+v(F.value)+" 张 ",1)]),_:1})]),t("div",ce,[t("h3",me,[l(n,null,{default:s(()=>[l(u(K))]),_:1}),a[8]||(a[8]=d(" 植物介绍 "))]),t("div",ge,[a[9]||(a[9]=d(" 中文学名：")),l(b,{modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=o=>e.value.name=o),placeholder:"请输入植物的学名"},null,8,["modelValue"]),a[10]||(a[10]=d(" 英文学名：")),l(b,{modelValue:e.value.ename,"onUpdate:modelValue":a[2]||(a[2]=o=>e.value.ename=o),placeholder:"请输入植物的英文学名"},null,8,["modelValue"])]),t("div",ve,[t("div",_e,[a[11]||(a[11]=t("div",{class:"lang-box-title"},"中文介绍",-1)),l(c,{prop:"descriptionCn"},{default:s(()=>[l(b,{modelValue:e.value.descriptionCn,"onUpdate:modelValue":a[3]||(a[3]=o=>e.value.descriptionCn=o),type:"textarea",rows:5,placeholder:"请输入植物中文介绍",onInput:U},null,8,["modelValue"])]),_:1})]),t("div",fe,[a[12]||(a[12]=t("div",{class:"lang-box-title"},"英文介绍",-1)),l(c,{prop:"descriptionEn"},{default:s(()=>[l(b,{modelValue:e.value.descriptionEn,"onUpdate:modelValue":a[4]||(a[4]=o=>e.value.descriptionEn=o),type:"textarea",rows:5,placeholder:"植物英文介绍（自动生成，可修改）"},null,8,["modelValue"])]),_:1})])])])]),t("div",ye,[t("h3",be,[l(n,null,{default:s(()=>[l(u(Q))]),_:1}),a[13]||(a[13]=d(" 预览效果 "))]),t("div",he,[(m(!0),g(x,null,k(e.value.images,(o,S)=>(m(),g("div",{class:"plant-card",key:S},[t("div",{class:"plant-image",style:ae({backgroundImage:"url("+o.url+")"})},[t("div",we," 系别 "+v(e.value.category||"?"),1)],4),t("div",Ee,[t("div",Ce,v(e.value.name||"植物名称"),1),t("div",Ve,v(e.value.descriptionCn||"请添加植物中文介绍"),1),t("div",xe,v(e.value.descriptionEn||"请添加植物英文简介"),1)])]))),128)),e.value.images.length<10?(m(),g("div",ke,[t("div",Fe,[l(n,{style:{"font-size":"50px",color:"#c2e7b0"}},{default:s(()=>[l(u(V))]),_:1})]),a[14]||(a[14]=t("div",{class:"plant-details",style:{"text-align":"center",color:"#909399"}}," 添加更多图片 ",-1))])):ee("",!0)])]),t("div",Ie,[l(C,{type:"info",onClick:E,size:"large"},{default:s(()=>[l(n,null,{default:s(()=>[l(u(W))]),_:1}),a[15]||(a[15]=d(" 重置表单 "))]),_:1,__:[15]}),l(C,{type:"primary",onClick:q,size:"large"},{default:s(()=>[l(n,null,{default:s(()=>[l(u(X))]),_:1}),a[16]||(a[16]=d(" 提交信息 "))]),_:1,__:[16]})])]),_:1},8,["model","rules"])])])])}}},Je=Y(Be,[["__scopeId","data-v-5ab109a0"]]);export{Je as default};
